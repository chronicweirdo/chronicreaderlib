<!DOCTYPE html>
<html>
    <head>
        <script src="/libs/jszip.js"></script>
        <!--script src="/libs/zip.js"></script-->
        <script src="/libs/bookNode.js"></script>
        <script src="/libs/reader.js"></script>
        <script>
            var book;
            window.onload = function() {
                // code to execute on the page load
                //var zip = new JSZip()
                /*fetch("/books/Feature_Comics_111.cbz")
                    .then(res => res.blob())
                    .then(blob => zip.loadAsync(blob))
                    .then(z => z.files[Object.entries(z.files)[3][0]].async("base64"))
                    .then(d => {
                        var img = document.getElementById("comicpage")
                        img.src="data:image/png;base64," + d
                    })*/
                // work with archive
                /*fetch("/books/Feature_Comics_111.cbz")
                    .then(res => res.blob())
                    .then(blob => {
                        let zip = new ZipWrapper(blob)
                        zip.getFiles().then(console.log)
                        return zip
                    })
                    .then(zip => {
                        zip.getBase64FileContents("Feature Comics 111/Feature Comics 111-01.jpg").then(b64 => {
                            var img = document.getElementById("comicpage")
                            img.src="data:image/png;base64," + b64
                        })
                    })*/
                // work directly with comic

                /*fetch("/books/Feature_Comics_111.cbz")
                    .then(res => res.blob())
                    .then(blob => {
                        let zip = new ZipWrapper(blob)
                        //zip.getFiles().then(console.log)
                        return zip
                    })
                    .then(zip => new ComicWrapper(zip))
                    .then(comic => {
                        comic.getContentsAt(7).then(b64 => {
                            var img = document.getElementById("comicpage")
                            img.src="data:image/png;base64," + b64
                        })
                    })*/
                
                
                fetch("/books/That_Affair_at_Elizabeth_by_Burton_Egbert_Stevenson.epub")
                    .then(res => res.blob())
                    .then(blob => {
                        let zip = new ZipWrapper(blob)
                        //zip.getFiles().then(console.log)
                        return zip
                    })
                    .then(zip => new EbookWrapper(zip))
                    .then(ebook => {
                        this.book = ebook
                        //ebook.parseOpf().then(res => spine = res)
                        ebook.getSize().then(size => {
                            writeToOutput(size)
                            let end = 6020
                            ebook.getContentsAt(5000, end).then(writeToPage)
                            ebook.findSpaceAfter(end).then(console.log)
                        })
                    })
            }
            function writeToOutput(text) {
                document.getElementById("output").innerHTML = text
            }
            function writeToPage(html) {
                document.getElementById("page").innerHTML = html
            }
        </script>
    </head>
<body>
    <h1>Simple static web server</h1>
    <p>Hello.</p>
    <p>A comic <a href="/books/Feature_Comics_111.cbz">here</a>.</p>
    <p><img id="comicpage"></img></p>
    <p id="output"></p>
    <div id="page"></div>
</body>
</html>